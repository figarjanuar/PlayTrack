"use strict";(()=>{var e={};e.id=867,e.ids=[867],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8830:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var i={};r.r(i),r.d(i,{GET:()=>m});var n=r(9303),a=r(8716),s=r(670),o=r(2021),p=r(5310),d=r(2880),u=r(7070);async function m(e){await (0,o.u)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),n=t.get("startDate"),a=t.get("endDate"),s=t.get("month"),m={};if(n&&a){let e=new Date(n),t=new Date(a);m.startTime={$gte:e,$lte:t}}else if(s){let[e,t]=s.split("-").map(Number),r=new Date(e,t-1,1),i=new Date(e,t,0,23,59,59);m.startTime={$gte:r,$lte:i}}let[l,c,g]=await Promise.all([p.z.countDocuments(m),p.z.find(m).sort({startTime:-1}).skip((r-1)*i).limit(i).lean(),d.TV.find().lean()]),f=Object.fromEntries(g.map(e=>[e._id.toString(),e])),[{totalFee:v=0}={}]=await p.z.aggregate([{$match:m},{$group:{_id:null,totalFee:{$sum:"$fee"}}}]),y=c.map(e=>(f[e.tv?.toString()],{id:e._id,tvName:e.tvName?`${e.tvName} (${e.psType})`:"-",ipAddress:e.tvIpAddress||"-",startTime:e.startTime,durationMinutes:e.duration,ended:"Ended"===e.status,fee:e.fee||0}));return u.NextResponse.json({page:r,totalPages:Math.ceil(l/i),total:l,totalFee:v,data:y})}let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/reports/route",pathname:"/api/reports",filename:"route",bundlePath:"app/api/reports/route"},resolvedPagePath:"/Users/figar_jr/project/android-tv-timer/app/api/reports/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:g,serverHooks:f}=l,v="/api/reports/route";function y(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},2021:(e,t,r)=>{r.d(t,{u:()=>s});var i=r(1185),n=r.n(i);let a=!1;async function s(){if(!a)try{await n().connect(process.env.MONGODB_URI||"mongodb://localhost:27017/tv_timer_prod"),a=!0,console.log("MongoDB connected")}catch(e){throw console.error("MongoDB connection error:",e),e}}},5310:(e,t,r)=>{r.d(t,{z:()=>s});var i=r(1185),n=r.n(i);let a=new(n()).Schema({tv:{type:n().Schema.Types.ObjectId,ref:"TV",required:!0},tvName:{type:String,required:!0},tvIpAddress:{type:String,required:!0},psType:{type:String,required:!0},startTime:{type:Date,required:!0},duration:{type:Number,required:!0},status:{type:String,enum:["Active","Ended"],default:"Active"},fee:{type:Number,required:!0}},{timestamps:!0}),s=n().models.Session||n().model("Session",a)},2880:(e,t,r)=>{r.d(t,{TV:()=>s});var i=r(1185),n=r.n(i);let a=new i.Schema({name:{type:String,required:!0},ipAddress:{type:String,required:!0},offlineCount:{type:Number,default:0},status:{type:String,enum:["Idle","Active","Offline","Ended"],default:"Idle"},currentSessionId:{type:n().Schema.Types.ObjectId,ref:"Session"},psType:{type:String,required:!0}},{timestamps:!0}),s=n().models.TV||n().model("TV",a)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,972],()=>r(8830));module.exports=i})();