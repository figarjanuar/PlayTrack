(()=>{var e={};e.id=971,e.ids=[971],e.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},1185:e=>{"use strict";e.exports=require("mongoose")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},665:e=>{"use strict";e.exports=require("dns")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},5807:e=>{"use strict";e.exports=require("module")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},8220:e=>{"use strict";e.exports=require("stream")},4026:e=>{"use strict";e.exports=require("string_decoder")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},9787:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>q,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{PATCH:()=>l});var i=r(9303),o=r(8716),n=r(670),u=r(2021),a=r(2880),p=r(5150),d=r(7070),c=r(4385);async function l(e){await (0,u.u)();let{tvId:t,additionalMinutes:r}=await e.json();if(!t||!r)return d.NextResponse.json({message:"Missing tvId or additionalMinutes"},{status:400});let s=await a.TV.findById(t).populate("currentSessionId");if(!s||!s.currentSessionId)return d.NextResponse.json({message:"Active session not found"},{status:404});let i=s.currentSessionId;i.duration+=r;let o=await c.p.findOne();if(!o)return d.NextResponse.json({message:"Settings not found"},{status:500});let n=r/60,l=o.psTypes?.[s.psType];if(!l)return d.NextResponse.json({message:`Harga belum diatur untuk jenis ${s.psType}`},{status:400});let m=l.packages?.find(e=>e.durationHours===n),x=m?m.price:(l.pricePerHour||0)*n;return i.fee+=x,await i.save(),await p.p.remove(t),await p.p.add(t,{tvId:t,ip:s.ipAddress,sessionId:i._id},{delay:6e4*i.duration,jobId:t}),d.NextResponse.json({message:"Session extended",session:i})}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/session/extend/route",pathname:"/api/session/extend",filename:"route",bundlePath:"app/api/session/extend/route"},resolvedPagePath:"/Users/figar_jr/project/android-tv-timer/app/api/session/extend/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:q}=m,g="/api/session/extend/route";function y(){return(0,n.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:f})}},2021:(e,t,r)=>{"use strict";r.d(t,{u:()=>n});var s=r(1185),i=r.n(s);let o=!1;async function n(){if(!o)try{await i().connect(process.env.MONGODB_URI||"mongodb://localhost:27017/tv_timer_prod"),o=!0,console.log("MongoDB connected")}catch(e){throw console.error("MongoDB connection error:",e),e}}},5150:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(6608),i=r(2197);let o=new(r.n(i)())({maxRetriesPerRequest:null}),n=new s.ci("powerOffTV",{connection:o})},4385:(e,t,r)=>{"use strict";r.d(t,{p:()=>u});var s=r(1185),i=r.n(s);let o=new s.Schema({durationHours:{type:Number,required:!0},price:{type:Number,required:!0}},{_id:!1});new s.Schema({name:{type:String,required:!0},pricePerHour:{type:Number,required:!0},packages:{type:[o],default:[]}},{_id:!1});let n=new s.Schema({psTypes:{type:s.Schema.Types.Mixed,required:!0}},{timestamps:!0}),u=i().models.Setting||i().model("Setting",n)},2880:(e,t,r)=>{"use strict";r.d(t,{TV:()=>n});var s=r(1185),i=r.n(s);let o=new s.Schema({name:{type:String,required:!0},ipAddress:{type:String,required:!0},offlineCount:{type:Number,default:0},status:{type:String,enum:["Idle","Active","Offline","Ended"],default:"Idle"},currentSessionId:{type:i().Schema.Types.ObjectId,ref:"Session"},psType:{type:String,required:!0}},{timestamps:!0}),n=i().models.TV||i().model("TV",o)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,608],()=>r(9787));module.exports=s})();