(()=>{var e={};e.id=488,e.ids=[488],e.modules={4665:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=4665,e.exports=t},1185:e=>{"use strict";e.exports=require("mongoose")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},665:e=>{"use strict";e.exports=require("dns")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},5807:e=>{"use strict";e.exports=require("module")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},8220:e=>{"use strict";e.exports=require("stream")},4026:e=>{"use strict";e.exports=require("string_decoder")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},6162:e=>{"use strict";e.exports=require("worker_threads")},3021:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>S,patchFetch:()=>h,requestAsyncStorage:()=>x,routeModule:()=>g,serverHooks:()=>w,staticGenerationAsyncStorage:()=>q});var s,i={};r.r(i),r.d(i,{POST:()=>v});var n=r(9303),a=r(8716),o=r(670),u=r(2021),p=r(2880),d=r(5310),c=r(4335),l=r(5150),m=r(7070),f=r(5743),y=r(4385);let v=(s=async e=>{await (0,u.u)();let{tvId:t,durationMinutes:r}=await e.json();if(!t||!r)return m.NextResponse.json({message:"Missing tvId or durationMinutes"},{status:400});let s=await p.TV.findById(t);if(!s)return m.NextResponse.json({message:"TV not found"},{status:404});await (0,c.X3)(s.ipAddress),await (0,c.Ig)(s.ipAddress);let i=await y.p.findOne();if(!i)return m.NextResponse.json({message:"Settings not found"},{status:500});let n=r/60,a=i.psTypes?.[s.psType];if(!a)return m.NextResponse.json({message:`Harga belum diatur untuk jenis ${s.psType}`},{status:400});let o=a.packages?.find(e=>e.durationHours===n),f=o?o.price:(a.pricePerHour||0)*n,v=new Date,g=await d.z.create({tv:s._id,tvName:s.name,tvIpAddress:s.ipAddress,psType:s.psType,startTime:v,duration:r,fee:f});return s.status="Active",s.currentSessionId=g._id,await s.save(),await l.p.remove(t),await l.p.add(t,{tvId:t,ip:s.ipAddress,sessionId:g._id},{delay:6e4*r,jobId:t}),m.NextResponse.json({message:"Session started",session:g})},async function(e){return(0,f.R)()?s(e):m.NextResponse.json({message:"License invalid or expired."},{status:403})}),g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/session/start/route",pathname:"/api/session/start",filename:"route",bundlePath:"app/api/session/start/route"},resolvedPagePath:"/Users/figar_jr/project/android-tv-timer/app/api/session/start/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:x,staticGenerationAsyncStorage:q,serverHooks:w}=g,S="/api/session/start/route";function h(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:q})}},4335:(e,t,r)=>{"use strict";r.d(t,{Ig:()=>u,X3:()=>o,bT:()=>p});var s=r(1764),i=r.n(s),n=r(1282);let a=i().promisify(n.exec);async function o(e){await a(`adb connect ${e}`)}async function u(e){await a(`adb -s ${e}:5555 shell input keyevent 224`),await a(`adb -s ${e}:5555 shell input keyevent 178`),await a(`adb -s ${e}:5555 shell input keyevent 23`)}async function p(e){await a(`adb -s ${e}:5555 shell input keyevent 3`)}},5743:(e,t,r)=>{"use strict";r.d(t,{Y:()=>y,R:()=>f});var s=r(2048),i=r.n(s),n=r(5315),a=r.n(n),o=r(4770),u=r.n(o);let p=a().join(process.cwd(),"license.json"),d=a().join(process.cwd(),"public.pem");function c(){try{let e=i().readFileSync(p,"utf8"),{data:t,signature:r}=JSON.parse(e),s=i().readFileSync(d,"utf8"),n=u().createVerify("RSA-SHA256"),a=JSON.stringify(t);if(n.update(a),n.end(),!n.verify(s,r,"base64"))return console.error("❌ License verification failed."),null;return t}catch(e){return console.error("❌ Error reading license:",e),null}}var l=r(9801),m=r.n(l);function f(){let e=c();if(!e||new Date>new Date(e.expiredAt))return!1;let t=function(){for(let e of Object.values(m().networkInterfaces()))for(let t of e||[])if(!t.internal&&t.mac&&"00:00:00:00:00:00"!==t.mac)return t.mac.toLowerCase();return"unknown"}();return Array.isArray(e.mac)&&e.mac.includes(t)}function y(){return c()}},2021:(e,t,r)=>{"use strict";r.d(t,{u:()=>a});var s=r(1185),i=r.n(s);let n=!1;async function a(){if(!n)try{await i().connect(process.env.MONGODB_URI||"mongodb://localhost:27017/tv_timer_prod"),n=!0,console.log("MongoDB connected")}catch(e){throw console.error("MongoDB connection error:",e),e}}},5150:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});var s=r(6608),i=r(2197);let n=new(r.n(i)())({maxRetriesPerRequest:null}),a=new s.ci("powerOffTV",{connection:n})},5310:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var s=r(1185),i=r.n(s);let n=new(i()).Schema({tv:{type:i().Schema.Types.ObjectId,ref:"TV",required:!0},tvName:{type:String,required:!0},tvIpAddress:{type:String,required:!0},psType:{type:String,required:!0},startTime:{type:Date,required:!0},duration:{type:Number,required:!0},status:{type:String,enum:["Active","Ended"],default:"Active"},fee:{type:Number,required:!0}},{timestamps:!0}),a=i().models.Session||i().model("Session",n)},4385:(e,t,r)=>{"use strict";r.d(t,{p:()=>o});var s=r(1185),i=r.n(s);let n=new s.Schema({durationHours:{type:Number,required:!0},price:{type:Number,required:!0}},{_id:!1});new s.Schema({name:{type:String,required:!0},pricePerHour:{type:Number,required:!0},packages:{type:[n],default:[]}},{_id:!1});let a=new s.Schema({psTypes:{type:s.Schema.Types.Mixed,required:!0}},{timestamps:!0}),o=i().models.Setting||i().model("Setting",a)},2880:(e,t,r)=>{"use strict";r.d(t,{TV:()=>a});var s=r(1185),i=r.n(s);let n=new s.Schema({name:{type:String,required:!0},ipAddress:{type:String,required:!0},offlineCount:{type:Number,default:0},status:{type:String,enum:["Idle","Active","Offline","Ended"],default:"Idle"},currentSessionId:{type:i().Schema.Types.ObjectId,ref:"Session"},psType:{type:String,required:!0}},{timestamps:!0}),a=i().models.TV||i().model("TV",n)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,608],()=>r(3021));module.exports=s})();